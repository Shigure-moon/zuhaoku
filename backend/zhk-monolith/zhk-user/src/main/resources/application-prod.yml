spring:
  application:
    name: zhk-user
  
  # HTTP 编码配置
  http:
    encoding:
      charset: UTF-8
      enabled: true
      force: true
  
  # 服务器配置
  server:
    port: ${PORT:8080}  # Zeabur 会自动设置 PORT 环境变量
    servlet:
      encoding:
        charset: UTF-8
        enabled: true
        force: true

  # 数据源配置（云数据库）
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${MYSQL_HOST:mysql2.sqlpub.com}:${MYSQL_PORT:3307}/${MYSQL_DATABASE:zuhaoku}?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=true&allowPublicKeyRetrieval=true
    username: ${MYSQL_USER:shigure2}
    password: ${MYSQL_PASSWORD}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      # 增加查询超时时间，避免长时间查询导致连接失败
      data-source-properties:
        socketTimeout: 60000
        connectTimeout: 30000

  # Redis 配置（可选，如果不配置则禁用 Redis 相关功能）
  # 注意：如果 REDIS_HOST 为空，需要排除 Redis 自动配置
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration
      - org.springframework.boot.actuate.autoconfigure.data.redis.RedisHealthContributorAutoConfiguration
      - org.springframework.boot.actuate.autoconfigure.data.redis.RedisReactiveHealthContributorAutoConfiguration
  data:
    redis:
      # 如果 REDIS_HOST 为空，上面的 exclude 会禁用 Redis 自动配置
      host: ${REDIS_HOST:}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: 0
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0

# MyBatis-Plus 配置
mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  type-aliases-package: com.zhk.**.entity
  configuration:
    map-underscore-to-camel-case: true
    # 生产环境通过日志级别控制 SQL 日志，不在这里配置 log-impl
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# 应用配置
zhk:
  # JWT 配置（生产环境应使用环境变量）
  jwt:
    secret: ${JWT_SECRET:993056993056993056993056993056993056}
    expiration: 86400000 # 24小时
  
  # 加密配置（生产环境应使用环境变量）
  encryption:
    algorithm: AES
    mode: GCM
    key: ${ENCRYPTION_KEY:993056993056993056993056993056993056}
    master-key: ${ENCRYPTION_MASTER_KEY:993056993056993056993056993056993056}

  # MinIO 配置（生产环境）
  minio:
    endpoint: ${MINIO_ENDPOINT:}
    access-key: ${MINIO_ACCESS_KEY:}
    secret-key: ${MINIO_SECRET_KEY:}
    bucket-name: ${MINIO_BUCKET:zhk-evidence}

  # 支付宝配置（生产环境）
  alipay:
    app-id: ${ALIPAY_APP_ID:2021006112616763}
    private-key: ${ALIPAY_PRIVATE_KEY:}
    alipay-public-key: ${ALIPAY_PUBLIC_KEY:}
    gateway-url: ${ALIPAY_GATEWAY_URL:https://openapi.alipay.com/gateway.do}
    encrypt-key: ${ALIPAY_ENCRYPT_KEY:}
    notify-url: ${ALIPAY_NOTIFY_URL:}
    return-url: ${ALIPAY_RETURN_URL:}
    sign-type: ${ALIPAY_SIGN_TYPE:RSA2}
    charset: ${ALIPAY_CHARSET:UTF-8}

# 日志配置
logging:
  level:
    root: INFO
    com.zhk: INFO
    org.springframework.security: WARN
    org.springframework.web: INFO
    # 关闭 MyBatis SQL 日志
    com.baomidou.mybatisplus: WARN
    org.apache.ibatis: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

