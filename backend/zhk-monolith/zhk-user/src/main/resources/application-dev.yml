spring:
  application:
    name: zhk-user
  
  # HTTP 编码配置
  http:
    encoding:
      charset: UTF-8
      enabled: true
      force: true
  
  # 服务器配置
  server:
    port: 8081  # 开发环境使用 8081，避免端口冲突
    # 注意：不设置 context-path，路径在 Controller 中定义
    servlet:
      encoding:
        charset: UTF-8
        enabled: true
        force: true

  # 数据源配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    # Docker 环境：使用容器服务名 mysql
    # 本地环境：使用 localhost:3307（避免与系统 MySQL 冲突）
    url: jdbc:mysql://${MYSQL_HOST:localhost}:${MYSQL_PORT:3307}/zhk_rental?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false
    username: ${MYSQL_USER:root}
    password: ${MYSQL_PASSWORD:root123456}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # Redis 配置
  data:
    redis:
      # Docker 环境：使用容器服务名 redis
      # 本地环境：使用 localhost:6380（避免与系统 Redis 冲突）
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6380}
      password: ${REDIS_PASSWORD:}
      database: 0
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0

# MyBatis-Plus 配置
mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  # 扫描所有模块的实体类
  type-aliases-package: com.zhk.**.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    # 确保使用 UTF-8 编码
    default-executor-type: reuse
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# 应用配置
zhk:
  # JWT 配置
  jwt:
    secret: zhk-rental-core-secret-key-min-256-bits-for-security-please-change-in-production
    expiration: 86400000 # 24小时
  
  # 加密配置
  encryption:
    algorithm: AES
    mode: GCM
    key: zhk-encryption-key-32-bytes-long
    master-key: ZHK-RentalCore-2024-MasterKey-32Bytes!!

  # MinIO 配置（开发环境）
  minio:
    endpoint: http://localhost:9002
    access-key: minioadmin
    secret-key: minioadmin123
    bucket-name: zhk-evidence

  # 支付宝配置（开发环境）
  alipay:
    app-id: YOUR_APP_ID  # 从支付宝开放平台获取
    private-key: |
      -----BEGIN PRIVATE KEY-----
      # 使用 backend/scripts/alipay-keys/alipay_app_private_key_pkcs8.pem 文件内容
      # 注意：生产环境请使用环境变量或密钥管理服务
      -----END PRIVATE KEY-----
    alipay-public-key: |
      -----BEGIN PUBLIC KEY-----
      # 从支付宝开放平台下载的支付宝公钥
      # 上传应用公钥后，在开放平台下载支付宝公钥
      -----END PUBLIC KEY-----
    gateway-url: https://openapi.alipay.com/gateway.do
    # 沙箱环境: https://openapi.alipaydev.com/gateway.do
    encrypt-key: lE4SjgSUUKi5tmrfKB3A3g==
    notify-url: http://localhost:8081/api/v1/payments/alipay/notify
    return-url: http://localhost:3000/tenant/orders
    sign-type: RSA2
    charset: UTF-8

  # 禁用 Redisson 自动配置（如果暂时不需要 Redis 功能）
  autoconfigure:
    exclude:
      - org.redisson.spring.starter.RedissonAutoConfiguration
      - org.springframework.boot.actuate.autoconfigure.data.redis.RedisReactiveHealthContributorAutoConfiguration
      - org.springframework.boot.actuate.autoconfigure.data.redis.RedisHealthContributorAutoConfiguration

# 日志配置
logging:
  level:
    com.zhk: DEBUG
    org.springframework.security: DEBUG

