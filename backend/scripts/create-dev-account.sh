#!/bin/bash
# åˆ›å»ºå¼€å‘è€…è´¦å·è„šæœ¬

set -e

echo "=========================================="
echo "åˆ›å»ºå¼€å‘è€…æµ‹è¯•è´¦å·"
echo "=========================================="

# è·å–é¡¹ç›®æ ¹ç›®å½•
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

# æ£€æŸ¥ MySQL å®¹å™¨æ˜¯å¦è¿è¡Œ
if docker ps | grep -q zhk-mysql-dev; then
    echo "âœ… æ£€æµ‹åˆ° MySQL å®¹å™¨è¿è¡Œä¸­"
    echo ""
    echo "æ­£åœ¨åˆ›å»ºå¼€å‘è€…è´¦å·..."
    echo ""
    
    # æ‰§è¡Œ SQL è„šæœ¬ï¼ˆä½¿ç”¨ utf8mb4 å­—ç¬¦é›†ï¼‰
    docker exec -i zhk-mysql-dev mysql -uroot -proot123456 --default-character-set=utf8mb4 zhk_rental < "$SCRIPT_DIR/dev-accounts.sql"
    
    echo ""
    echo "âœ… å¼€å‘è€…è´¦å·åˆ›å»ºå®Œæˆï¼"
    echo ""
    echo "ğŸ“Œ è´¦å·ä¿¡æ¯ï¼š"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "è§’è‰²     â”‚ æ‰‹æœºå·      â”‚ å¯†ç        â”‚ æ˜µç§°"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "ç§Ÿå®¢     â”‚ 13800000001 â”‚ dev123456  â”‚ æµ‹è¯•ç§Ÿå®¢"
    echo "å•†å®¶     â”‚ 13800000002 â”‚ dev123456  â”‚ æµ‹è¯•å•†å®¶"
    echo "è¿è¥     â”‚ 13800000003 â”‚ dev123456  â”‚ æµ‹è¯•è¿è¥"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "ğŸ’¡ æç¤ºï¼š"
    echo "  - å‰ç«¯ç™»å½•æ—¶ï¼Œç”¨æˆ·åä½¿ç”¨æ‰‹æœºå·"
    echo "  - å¯†ç ç»Ÿä¸€ä¸º: dev123456"
    echo "  - è¿™äº›è´¦å·ä»…ç”¨äºå¼€å‘æµ‹è¯•ï¼Œè¯·å‹¿åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨"
    
else
    echo "âŒ MySQL å®¹å™¨æœªè¿è¡Œ"
    echo ""
    echo "è¯·å…ˆå¯åŠ¨ Docker æœåŠ¡ï¼š"
    echo "  cd $PROJECT_ROOT"
    echo "  ./backend/scripts/docker-setup.sh"
    exit 1
fi

